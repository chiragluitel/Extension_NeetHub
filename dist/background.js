console.log("NeetHub Background Service Worker Loaded.");chrome.runtime.onMessage.addListener((o,w,i)=>o.type==="PUSH_CODE_TO_GITHUB"?(console.log("Background: Received push request",o.data),(async()=>{var c;try{const t=await chrome.storage.local.get(["githubToken","selectedRepo"]),n=t.githubToken,l=t.selectedRepo;if(!n)throw new Error("Not logged in to GitHub.");if(!l)throw new Error("GitHub repository not selected. Please configure in the NeetHub popup.");const{problemTitle:k,problemSlug:h,language:d,fileExtension:E,code:g,sourceUrl:f}=o.data,[H,$]=l.split("/"),A=h.replace(/[^a-zA-Z0-9-_]/g,"_"),u='<span class="math-inline">{safeSlug}.</span>{fileExtension}',m=`feat: Add <span class="math-inline">{problemTitle} solution (${d}) NeetCode Problem (${f}) Solved using NeetHub Extension.`,b=btoa(unescape(encodeURIComponent(g))),p=`https://api.github.com/repos/<span class="math-inline">{owner}/</span>{repo}/contents/${u}`;let s;try{const e=await fetch(p,{method:"GET",headers:{Authorization:`token ${n}`,Accept:"application/vnd.github.v3+json"}});if(e.ok)s=(await e.json()).sha,console.log(`File ${u} exists. SHA: ${s}`);else if(e.status!==404)throw new Error(`GitHub API error checking file: ${e.status} ${e.statusText}`)}catch(e){console.warn(`Could not check file existence (maybe repo is brand new?): ${e}. Proceeding with creation attempt.`)}const r=await fetch(p,{method:"PUT",headers:{Authorization:`token ${n}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify({message:m,content:b,sha:s})}),a=await r.json();if(!r.ok)throw new Error(`GitHub API Error (${r.status}): ${a.message||"Failed to push file."}`);console.log("GitHub API Response:",a),i({success:!0,url:(c=a.content)==null?void 0:c.html_url})}catch(t){console.error("Background: Error processing push request:",t),i({success:!1,error:t.message||"An unknown error occurred."})}})(),!0):!1);chrome.runtime.onInstalled.addListener(o=>{o.reason==="install"?console.log("NeetHub installed!"):o.reason==="update"&&console.log("NeetHub updated to version",chrome.runtime.getManifest().version)});
